<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Moodle Downloader - Real Moodle Simulation Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #2196F3;
            padding-bottom: 10px;
        }
        h2 {
            color: #555;
            margin-top: 20px;
        }
        .test-case {
            margin: 20px 0;
            padding: 15px;
            border-left: 4px solid #2196F3;
            background-color: #f9f9f9;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        .pass {
            background-color: #c8e6c9;
            color: #2e7d32;
        }
        .fail {
            background-color: #ffcdd2;
            color: #c62828;
        }
        .code {
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
            overflow-x: auto;
            max-height: 300px;
            overflow-y: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: right;
        }
        th {
            background-color: #2196F3;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .moodle-sim {
            background: #f0f0f0;
            padding: 20px;
            border: 2px solid #ccc;
            margin: 15px 0;
            border-radius: 4px;
        }
        .content {
            background: white;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
        }
        .activity {
            display: flex;
            align-items: center;
            padding: 10px;
            background: #fafafa;
            margin: 5px 0;
            border-radius: 3px;
            border-left: 3px solid #2196F3;
        }
        .instancename {
            flex: 1;
            margin-right: 10px;
        }
        .file-type {
            background: #e3f2fd;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .summary {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª ×‘×“×™×§×ª ×ª××™××•×ª ×¢× ×“×£ Moodle ×××™×ª×™</h1>
        <h2>Real Moodle Page Compatibility Test</h2>
        
        <div class="test-case">
            <h2>××¦×‘ ×”×“×•×§"×Ÿ: ×¡×™××•×œ×¦×™×™×ª ×“×£ Moodle ×¢×‘×¨×™</h2>
            <p>×‘×“×™×§×ª ×§×‘×œ×ª ×”×§×‘×¦×™× ××“×£ Moodle ×¢×‘×¨×™ - × ×™×¡×™×•×Ÿ ×œ×¡×¨×•×§ ××ª ×”××‘× ×” ×©×§×™×™× ×‘×“×£ Moodle ×©×œ ××•× ×™×‘×¨×¡×™×˜×ª ×ª×œ ××‘×™×‘:</p>
            
            <div class="moodle-sim" id="moodle-sim">
                <h3>×”×§×•×¨×¡: ×ª×›× ×•×Ÿ ××¢×¨×›×•×ª ×‘×¡×™×¡×™ × ×ª×•× ×™×</h3>
                <div class="content">
                    <h4>×©×‘×•×¢ 1: ××‘×•× ×œ××¡×“×™ × ×ª×•× ×™×</h4>
                    
                    <div class="activity">
                        <div class="instancename">
                            <span>Introduction_to_Databases.pdf</span>
                            <span class="file-type">×§×•×‘×¥</span>
                        </div>
                    </div>
                    
                    <div class="activity">
                        <div class="instancename">
                            <span>×¡×™×›×•×_×”×¨×¦××”_×©×‘×•×¢_1.pdf</span>
                            <span class="file-type">×§×•×‘×¥</span>
                        </div>
                    </div>
                    
                    <div class="activity">
                        <div class="instancename">
                            <span>×ª×™×§×™×™×ª_×ª×¨×’×™×œ×™×</span>
                            <span class="file-type">×ª×™×§×™×™×”</span>
                        </div>
                    </div>
                    
                    <div class="activity">
                        <div class="instancename">
                            <span>×§×™×©×•×¨_×œ××××¨_×—×©×•×‘</span>
                            <span class="file-type">×›×ª×•×‘×ª ××™× ×˜×¨× ×˜</span>
                        </div>
                    </div>
                </div>

                <div class="content">
                    <h4>×©×‘×•×¢ 2: ××•×“×œ ×™×—×¡×™</h4>
                    
                    <div class="activity">
                        <div class="instancename">
                            <span>Relational_Model.pdf</span>
                            <span class="file-type">×§×•×‘×¥</span>
                        </div>
                    </div>
                    
                    <div class="activity">
                        <div class="instancename">
                            <span>××¦×’×ª_××•×“×œ_×™×—×¡×™.pptx</span>
                            <span class="file-type">×§×•×‘×¥</span>
                        </div>
                    </div>
                    
                    <div class="activity">
                        <div class="instancename">
                            <span>×ª×¨×’×™×œ_×‘× ×•×©×_×™×—×¡×™×</span>
                            <span class="file-type">×“×£</span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="test-results">
                <h3>ğŸ“Š ×ª×•×¦××•×ª ×”×‘×“×™×§×”:</h3>
            </div>
        </div>

        <div class="test-case" id="detailed-results">
            <h2>ğŸ“‹ ×¤×™×¨×•×˜ ×”×ª×•×¦××•×ª</h2>
            <div id="detailed-content"></div>
        </div>

        <div class="test-case" id="summary-section">
            <h2>ğŸ“ˆ ×¡×™×›×•×</h2>
            <div id="summary"></div>
        </div>
    </div>

    <script>
        // Supported file types (from the updated background.js)
        const SUPPORTED_FILES = new Set([
            "File",           // English: File
            "Folder",         // English: Folder
            "URL",            // English: URL
            "Page",           // English: Page
            "×§×•×‘×¥",           // Hebrew: File
            "×ª×™×§×™×™×”",         // Hebrew: Folder
            "×›×ª×•×‘×ª ××™× ×˜×¨× ×˜",  // Hebrew: URL
            "×“×£"              // Hebrew: Page
        ]);

        function sanitiseFilename(filename) {
            return filename.replace(/[\\/:*?"<>|]/g, "-");
        }

        function getFilesUnderSection() {
            // Simulating the actual background.js function
            return Array.from(document.querySelectorAll(".content"))
                .map(content => {
                    return Array.from(content.querySelectorAll(".activity"))
                        .map(activity => {
                            const instanceName = activity.querySelector(".instancename");
                            if (!instanceName) return null;
                            
                            const nameSpan = instanceName.querySelector("span:first-child");
                            const typeSpan = instanceName.querySelector(".file-type");
                            
                            if (!nameSpan || !typeSpan) return null;
                            
                            return {
                                name: nameSpan.textContent.trim(),
                                type: typeSpan.textContent.trim(),
                                element: activity
                            };
                        })
                        .filter(item => item !== null)
                        .filter(item => SUPPORTED_FILES.has(item.type));
                })
                .reduce((x, y) => x.concat(y), []);
        }

        function runTest() {
            const files = getFilesUnderSection();
            const detailedHtml = document.getElementById("detailed-content");
            const testResults = document.getElementById("test-results");

            // Group files by type
            const filesByType = {};
            files.forEach(file => {
                if (!filesByType[file.type]) {
                    filesByType[file.type] = [];
                }
                filesByType[file.type].push(file);
            });

            // Generate results table
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>×¡×•×’ ×”×§×•×‘×¥ | File Type</th>
                            <th>×©× ×”×§×•×‘×¥ | Filename</th>
                            <th>×ª×¨×’×•× | Translation</th>
                            <th>××¡×•× ×Ÿ? | Sanitized?</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            const typeTranslations = {
                "×§×•×‘×¥": "File",
                "×ª×™×§×™×™×”": "Folder",
                "×›×ª×•×‘×ª ××™× ×˜×¨× ×˜": "URL",
                "×“×£": "Page"
            };

            files.forEach(file => {
                const sanitized = sanitiseFilename(file.name);
                html += `
                    <tr>
                        <td><strong>${file.type}</strong></td>
                        <td>${file.name}</td>
                        <td>${typeTranslations[file.type] || file.type}</td>
                        <td>${sanitized}</td>
                    </tr>
                `;
            });

            html += `
                    </tbody>
                </table>
            `;

            detailedHtml.innerHTML = html;

            // Summary
            const totalFiles = files.length;
            const englishCount = files.filter(f => ["File", "Folder", "URL", "Page"].includes(f.type)).length;
            const hebrewCount = files.filter(f => ["×§×•×‘×¥", "×ª×™×§×™×™×”", "×›×ª×•×‘×ª ××™× ×˜×¨× ×˜", "×“×£"].includes(f.type)).length;

            let summaryHtml = `
                <div class="summary">
                    <h3>âœ… ×‘×“×™×§×” ×”×¦×œ×™×—×”!</h3>
                    <p><strong>×¡×š ×”×§×•×‘×¦×™× ×©×–×•×”×•:</strong> ${totalFiles}</p>
                    <ul>
                        <li><strong>×§×•×‘×¦×™× ×‘×¢×‘×¨×™×ª:</strong> ${hebrewCount}</li>
                        <li><strong>×§×•×‘×¦×™× ×‘×× ×’×œ×™×ª:</strong> ${englishCount}</li>
                    </ul>
                    <p><strong>×§×•×‘×¦×™× ×œ×›×œ ×¡×•×’:</strong></p>
                    <ul>
            `;

            Object.entries(filesByType).forEach(([type, typeFiles]) => {
                const translation = typeTranslations[type] || type;
                summaryHtml += `<li>${type} (${translation}): ${typeFiles.length} ×§×•×‘×¦×™×</li>`;
            });

            summaryHtml += `
                    </ul>
                    <h3>ğŸ‰ ×”××¢×¨×›×ª ×ª×•×›×œ ×œ×”×•×¨×™×“ ××ª ×›×œ ×”×§×•×‘×¦×™× ×”×‘××™×:</h3>
                    <ul>
            `;

            files.forEach(file => {
                summaryHtml += `<li>ğŸ“„ ${file.name} <span style="color: #666;">(${file.type})</span></li>`;
            });

            summaryHtml += `
                    </ul>
                </div>
            `;

            document.getElementById("summary").innerHTML = summaryHtml;

            // Test result indicator
            const testResult = document.createElement("div");
            if (totalFiles > 0) {
                testResult.className = "test-result pass";
                testResult.innerHTML = `âœ… <strong>×‘×“×™×§×” ×¢×‘×¨×” ×‘×”×¦×œ×—×”!</strong><br>× ××¦××• ${totalFiles} ×§×•×‘×¦×™× ×©× ×™×ª×Ÿ ×œ×”×•×¨×“×” (${hebrewCount} ×‘×¢×‘×¨×™×ª ×•-${englishCount} ×‘×× ×’×œ×™×ª)`;
            } else {
                testResult.className = "test-result fail";
                testResult.innerHTML = `âŒ <strong>×‘×“×™×§×” × ×›×©×œ×”</strong><br>×œ× × ××¦××• ×§×•×‘×¦×™×`;
            }
            
            testResults.appendChild(testResult);
        }

        // Run test when page loads
        window.addEventListener('load', () => {
            runTest();
        });
    </script>
</body>
</html>
